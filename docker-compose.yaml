version: '3.8'

services:
  octosync:
    image: octosync:latest
    build:
      context: .
      dockerfile: Dockerfile
    ports:
      - "${PORT:-8000}:8000"
    environment:
      - NODE_ENV=${NODE_ENV:-production}
      - GITHUB_TOKEN=${GITHUB_TOKEN}
      - GITHUB_ORGANIZATION=${GITHUB_ORGANIZATION}
      - GITHUB_REPOSITORY=${GITHUB_REPOSITORY}
      - JIRA_HOST=${JIRA_HOST}
      - JIRA_API_TOKEN=${JIRA_API_TOKEN}
      - JIRA_ISSUER_EMAIL=${JIRA_ISSUER_EMAIL}
      - JIRA_PROJECT=${JIRA_PROJECT}
      - JIRA_PROJECT_ID=${JIRA_PROJECT_ID}
      - JIRA_DONE_TRANSITION_ID=${JIRA_DONE_TRANSITION_ID:-41}
      - JIRA_DONE_STATUS_NAME=${JIRA_DONE_STATUS_NAME:-Done}
      - JIRA_CUSTOM_GITHUB_REPOSITORY_FIELD=${JIRA_CUSTOM_GITHUB_REPOSITORY_FIELD}
      - JIRA_CUSTOM_GITHUB_ISSUE_NUMBER_FIELD=${JIRA_CUSTOM_GITHUB_ISSUE_NUMBER_FIELD}
    volumes:
      - ./logs:/app/logs
      - ./config.yaml:/app/config.yaml:ro
    # depends_on:
    #   - redis
    restart: unless-stopped
    networks:
      - octosync-network

  # Redis service for future queue system implementation
  # Uncomment when BullMQ integration is complete
  # redis:
  #   image: redis:7-alpine
  #   ports:
  #     - "6379:6379"
  #   volumes:
  #     - redis-data:/data
  #   restart: unless-stopped
  #   networks:
  #     - octosync-network
  #   command: redis-server --appendonly yes

volumes:
  # redis-data:

networks:
  octosync-network:
    driver: bridge
